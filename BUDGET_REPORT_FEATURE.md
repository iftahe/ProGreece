# ×ª×™×¢×•×“ ×¢×“×›×•× ×™× - ×ª×›×•× ×ª ×“×•×— ×ª×§×¦×™×‘ ××•×œ ×‘×™×¦×•×¢ (Budget vs Actual Report)

## ×ª××¨×™×š: 2025-01-XX
## ×¡× ×™×£: `feature/budget-reports`

---

## ×¡×§×™×¨×” ×›×œ×œ×™×ª

×”×•×¡×¤×ª ×ª×›×•× ×ª ×“×•×— ×ª×§×¦×™×‘ ××•×œ ×‘×™×¦×•×¢ ×”×××¤×©×¨×ª ×œ×”×¦×™×’ ×”×©×•×•××” ×‘×™×Ÿ ×”×ª×§×¦×™×‘ ×”××ª×•×›× ×Ÿ ×œ×‘×™×Ÿ ×”×”×•×¦××•×ª ×‘×¤×•×¢×œ ×¢×‘×•×¨ ×›×œ ×¤×¨×•×™×§×˜. ×”×“×•×— ××¦×™×’ ××ª ×”× ×ª×•× ×™× ×‘×”×™×¨×¨×›×™×” ×©×œ ×©×œ×‘×™× (Phases) ×•×§×˜×’×•×¨×™×•×ª ××©× ×”.

---

## ×©×™× ×•×™×™× ×‘-Backend

### 1. ×§×•×‘×¥ `schemas.py`

#### ×”×•×¡×¤×ª ×¡×›××•×ª Pydantic ×—×“×©×•×ª:

**`BudgetReportItem`** - ×¤×¨×™×˜ ×‘×•×“×“ ×‘×“×•×—:
- `id`: ××–×”×” ×”×§×˜×’×•×¨×™×”
- `name`: ×©× ×”×§×˜×’×•×¨×™×”
- `budget_amount`: ×¡×›×•× ×ª×§×¦×™×‘ ××ª×•×›× ×Ÿ
- `actual_amount`: ×¡×›×•× ×‘×™×¦×•×¢ ×‘×¤×•×¢×œ (×¡×›×•× ×©×œ ×›×œ ×”×ª× ×•×¢×•×ª ×”××©×•×™×›×•×ª)
- `variance`: ×”×¡×˜×™×” (Budget - Actual)
- `percentage_used`: ××—×•×– ×©×™××•×© (Actual / Budget * 100)
- `is_phase`: ×”×× ×–×” ×©×œ×‘ (Phase) ××• ×§×˜×’×•×¨×™×™×ª ××©× ×”
- `children`: ×¨×©×™××ª ×§×˜×’×•×¨×™×•×ª ××©× ×” (××•×¤×¦×™×•× ×œ×™)

**`BudgetReport`** - ××‘× ×” ×”×“×•×— ×”××œ×:
- `project_id`: ××–×”×” ×”×¤×¨×•×™×§×˜
- `phases`: ×¨×©×™××ª ×”×©×œ×‘×™× ×¢× ×›×œ ×”×§×˜×’×•×¨×™×•×ª ×”××©× ×” ×©×œ×”×

#### ×©×™× ×•×™×™× × ×•×¡×¤×™×:
- ×”×•×¡×¤×ª ×™×™×‘×•× `List` ×-`typing` ×‘×ª×—×™×œ×ª ×”×§×•×‘×¥

---

### 2. ×§×•×‘×¥ `main.py`

#### ×”×•×¡×¤×ª Endpoint ×—×“×©:

**`GET /projects/{project_id}/budget-report`**

**×¤×•× ×§×¦×™×•× ×œ×™×•×ª:**
1. **××™××•×ª**: ×‘×•×“×§ ×©×”×¤×¨×•×™×§×˜ ×§×™×™×
2. **××™×¡×•×£ × ×ª×•× ×™×**:
   - ××‘×™× ××ª ×›×œ ×§×˜×’×•×¨×™×•×ª ×”×ª×§×¦×™×‘ (`BudgetCategory`) ×©×œ ×”×¤×¨×•×™×§×˜
   - ××‘×™× ××ª ×›×œ ×”×ª× ×•×¢×•×ª (`Transaction`) ×©×œ ×”×¤×¨×•×™×§×˜
   - ××—×©×‘ ××ª ×¡×›×•× ×”×‘×™×¦×•×¢ (`actual_amount`) ×œ×›×œ ×§×˜×’×•×¨×™×” ×¢×œ ×™×“×™ ×¡×™×›×•× ×”×ª× ×•×¢×•×ª ×”××©×•×™×›×•×ª (`budget_item_id`)
3. **×‘× ×™×™×ª ×”×™×¨×¨×›×™×”**:
   - ××¤×¨×™×“ ×‘×™×Ÿ ×©×œ×‘×™× (Phases) - ×§×˜×’×•×¨×™×•×ª ×¢× `parent_id = None`
   - ××§×‘×¥ ×§×˜×’×•×¨×™×•×ª ××©× ×” ×œ×¤×™ `parent_id`
4. **×—×™×©×•×‘×™×**:
   - `variance = budget_amount - actual_amount`
   - `percentage_used = (actual_amount / budget_amount) * 100` (×¢× ×”×’× ×” ××¤× ×™ ×—×œ×•×§×” ×‘××¤×¡)
5. **××’×¨×’×¦×™×”**:
   - ×¢×‘×•×¨ ×›×œ ×©×œ×‘ (Phase), ××—×©×‘ ××ª ×”×¡×›×•××™× ×”×›×•×œ×œ×™× ×©×œ ×›×œ ×”×§×˜×’×•×¨×™×•×ª ×”××©× ×”
   - ×›×•×œ×œ ×’× ×¡×›×•××™× ×™×©×™×¨×™× ×©×œ ×”×©×œ×‘ ×¢×¦××• (×× ×§×™×™××™×)

**×™×™×‘×•××™× ×—×“×©×™×:**
- `from sqlalchemy import func` - ×œ×—×™×©×•×‘×™ SUM
- `from typing import Dict` - ×œ××™×œ×•× ×™×

---

## ×©×™× ×•×™×™× ×‘-Frontend

### 1. ×§×•×‘×¥ `api.js`

#### ×”×•×¡×¤×ª ×¤×•× ×§×¦×™×” ×—×“×©×”:

```javascript
export const getBudgetReport = async (projectId) => {
    const response = await api.get(`/projects/${projectId}/budget-report`);
    return response.data;
};
```

**×”×¢×¨×”**: ×œ×¤×™ ×”×©×™× ×•×™×™× ×©× ×¢×©×•, × ×¨××” ×©×”×¤×•× ×§×¦×™×” ×”×•×¡×¨×”. ×™×© ×œ×‘×“×•×§ ×× ×™×© ×¦×•×¨×š ×œ×”×—×–×™×¨ ××•×ª×”.

---

### 2. ×§×•×‘×¥ `frontend/src/components/BudgetReport.jsx` (×§×•×‘×¥ ×—×“×©)

#### ×¨×›×™×‘ React ×—×“×© ×œ×“×•×— ×ª×§×¦×™×‘

**×ª×›×•× ×•×ª:**
- **Modal Overlay**: ××•×¦×’ ×›×—×œ×•×Ÿ ××•×“××œ×™ ××¢×œ ×”×ª×•×›×Ÿ
- **×˜×‘×œ×” ×”×™×¨×¨×›×™×ª**: ××¦×™×’×” ×©×œ×‘×™× (Phases) bold ×•×§×˜×’×•×¨×™×•×ª ××©× ×” ×¢× ×”×–×—×”
- **×¢××•×“×•×ª**:
  - Category: ×©× ×”×§×˜×’×•×¨×™×” (×¢× ×”×™×¨×¨×›×™×”)
  - Budget (Planned): ×ª×§×¦×™×‘ ××ª×•×›× ×Ÿ
  - Actual (Spent): ×‘×™×¦×•×¢ ×‘×¤×•×¢×œ
  - Remaining: ×™×ª×¨×” (Budget - Actual)
  - Status: ×¤×¡ ×”×ª×§×“××•×ª ×¦×‘×¢×•× ×™ + ××—×•×– ×©×™××•×©

**×ª×›×•× ×•×ª × ×•×¡×¤×•×ª:**
- **×¤×•×¨××˜ ××˜×‘×¢**: ×›×œ ×”×¡×›×•××™× ××•×¦×’×™× ×‘×¤×•×¨××˜ ××˜×‘×¢ ×¢× ×¡×™××Ÿ â‚ª
- **×¦×‘×¢×™ ×¡×˜×˜×•×¡**:
  - ×™×¨×•×§: ×¢×“ 80% ×©×™××•×©
  - ×›×ª×•×: 80-100% ×©×™××•×©
  - ××“×•×: ××¢×œ 100% ×©×™××•×© (×—×¨×™×’×” ××”×ª×§×¦×™×‘)
- **×˜×™×¤×•×œ ×‘×©×’×™××•×ª**: ××¦×™×’ ×”×•×“×¢×•×ª ×©×’×™××” ×¢× ××¤×©×¨×•×ª ×œ× ×¡×•×ª ×©×•×‘
- **××¦×‘×™ ×˜×¢×™× ×”**: ××¦×™×’ ×”×•×“×¢×ª ×˜×¢×™× ×” ×‘×–××Ÿ ××™×¡×•×£ ×”× ×ª×•× ×™×

**Props:**
- `projectId`: ××–×”×” ×”×¤×¨×•×™×§×˜
- `onClose`: ×¤×•× ×§×¦×™×” ×œ×¡×’×™×¨×ª ×”××•×“××œ

**×”×¢×¨×”**: ×œ×¤×™ ×”×©×™× ×•×™×™× ×©× ×¢×©×•, × ×¨××” ×©×”×§×•×‘×¥ × ××—×§. ×™×© ×œ×‘×“×•×§ ×× ×™×© ×¦×•×¨×š ×œ×”×—×–×™×¨ ××•×ª×•.

---

### 3. ×§×•×‘×¥ `frontend/src/pages/Projects.jsx`

#### ×©×™× ×•×™×™× ××ª×•×›× × ×™× (×œ× ××™×•×©××™× ×›×¨×’×¢):

**×”×•×¡×¤×” ××ª×•×›× × ×ª:**
- ×›×¤×ª×•×¨ "View Budget Report" ×œ×™×“ ×›×¤×ª×•×¨ "Edit"
- ×™×™×‘×•× ×©×œ `BudgetReport` component
- State management ×œ×¤×ª×™×—×”/×¡×’×™×¨×” ×©×œ ×”×“×•×—

**×”×¢×¨×”**: ×œ×¤×™ ×”×©×™× ×•×™×™× ×©× ×¢×©×•, × ×¨××” ×©×”×©×™× ×•×™×™× ×”×•×¡×¨×•. ×™×© ×œ×‘×“×•×§ ×× ×™×© ×¦×•×¨×š ×œ×”×—×–×™×¨ ××•×ª×.

---

## ×œ×•×’×™×§×ª ×—×™×©×•×‘×™×

### ×—×™×©×•×‘ Actual Amount:
```python
# ×¡×™×›×•× ×›×œ ×”×ª× ×•×¢×•×ª ×”××©×•×™×›×•×ª ×œ×§×˜×’×•×¨×™×”
actual_amount = SUM(Transaction.amount) 
WHERE Transaction.budget_item_id = BudgetCategory.id
AND Transaction.project_id = project_id
```

### ×—×™×©×•×‘ Variance:
```python
variance = budget_amount - actual_amount
```

### ×—×™×©×•×‘ Percentage Used:
```python
if budget_amount > 0:
    percentage_used = (actual_amount / budget_amount) * 100
else:
    percentage_used = 0 if actual_amount == 0 else 100
```

### ××’×¨×’×¦×™×” ×œ×©×œ×‘×™× (Phases):
```python
phase_budget = phase_own_budget + SUM(children_budgets)
phase_actual = phase_own_actual + SUM(children_actuals)
phase_variance = phase_budget - phase_actual
```

---

## ×”×’× ×•×ª ×•××‘×˜×—×”

1. **×—×œ×•×§×” ×‘××¤×¡**: ×›×œ ×—×™×©×•×‘×™ ×”××—×•×–×™× ×‘×•×“×§×™× ×©×”×ª×§×¦×™×‘ ×’×“×•×œ ×-0
2. **××™××•×ª ×¤×¨×•×™×§×˜**: ×”-endpoint ×‘×•×“×§ ×©×”×¤×¨×•×™×§×˜ ×§×™×™× ×œ×¤× ×™ ×”×—×–×¨×ª × ×ª×•× ×™×
3. **×˜×™×¤×•×œ ×‘×¢×¨×›×™× null**: ×›×œ ×”×¢×¨×›×™× ××˜×•×¤×œ×™× ×¢× ×¢×¨×›×™ ×‘×¨×™×¨×ª ××—×“×œ

---

## ×§×‘×¦×™× ×©× ×•×¡×¤×•/×©×•× ×•

### ×§×‘×¦×™× ×—×“×©×™×:
- `frontend/src/components/BudgetReport.jsx` (×”×•×¡×¨ ×œ×¤×™ ×”×©×™× ×•×™×™×)

### ×§×‘×¦×™× ×©×¢×•×“×›× ×•:
- `schemas.py` - ×”×•×¡×¤×ª ×¡×›××•×ª BudgetReport
- `main.py` - ×”×•×¡×¤×ª endpoint ×—×“×©
- `frontend/src/api.js` - ×”×•×¡×¤×ª ×¤×•× ×§×¦×™×™×ª API (×”×•×¡×¨×” ×œ×¤×™ ×”×©×™× ×•×™×™×)
- `frontend/src/pages/Projects.jsx` - ×”×•×¡×¤×ª ××™× ×˜×’×¨×¦×™×” (×”×•×¡×¨×” ×œ×¤×™ ×”×©×™× ×•×™×™×)

---

## ×”×¢×¨×•×ª ×—×©×•×‘×•×ª

1. **×”×¡×¨×ª ×©×™× ×•×™×™×**: × ×¨××” ×©×—×œ×§ ××”×©×™× ×•×™×™× ×‘-frontend ×”×•×¡×¨×•. ×™×© ×œ×‘×“×•×§ ×× ×™×© ×¦×•×¨×š ×œ×”×—×–×™×¨ ××•×ª× ××• ×œ×™×™×©× ××•×ª× ×‘×¦×•×¨×” ××—×¨×ª.

2. **××™× ×˜×’×¨×¦×™×” ×¢×ª×™×“×™×ª**: ×™×© ×œ×”×—×œ×™×˜ ××™×š ×œ×©×œ×‘ ××ª ×”×“×•×— ×‘×××©×§ ×”××©×ª××© - ×”×× ×›××•×“××œ, ×›×¢××•×“ × ×¤×¨×“, ××• ×›×—×œ×§ ××”×“×£ ×©×œ ×”×¤×¨×•×™×§×˜.

3. **×‘×™×¦×•×¢×™×**: ×”×“×•×— ××—×©×‘ ××ª ×›×œ ×”× ×ª×•× ×™× ×‘×›×œ ×§×¨×™××”. ×¢×‘×•×¨ ×¤×¨×•×™×§×˜×™× ×’×“×•×œ×™×, ×™×™×ª×›×Ÿ ×©×™×”×™×” ×¦×•×¨×š ×œ×©×§×•×œ caching ××• pagination.

---

## ×©×œ×‘×™× ×”×‘××™×

1. âœ… Backend endpoint - ×”×•×©×œ×
2. âœ… Schemas - ×”×•×©×œ××•
3. âš ï¸ Frontend component - × ×•×¦×¨ ××š ×”×•×¡×¨
4. âš ï¸ Integration in Projects page - ×œ× ××™×•×©×
5. ğŸ”„ Testing - ×™×© ×œ×‘×“×•×§ ××ª ×”-endpoint
6. ğŸ”„ Documentation - ×§×•×‘×¥ ×–×”

---

## ×“×•×’××ª Response ××”-API

```json
{
  "project_id": 1,
  "phases": [
    {
      "id": 1,
      "name": "Buying",
      "budget_amount": "100000.00",
      "actual_amount": "75000.00",
      "variance": "25000.00",
      "percentage_used": "75.00",
      "is_phase": true,
      "children": [
        {
          "id": 2,
          "name": "License",
          "budget_amount": "20000.00",
          "actual_amount": "15000.00",
          "variance": "5000.00",
          "percentage_used": "75.00",
          "is_phase": false,
          "children": null
        }
      ]
    }
  ]
}
```

---

## ×¡×™×›×•×

×”×ª×›×•× ×” ×”×•×©×œ××” ×‘-backend ×¢× endpoint ××œ× ×•×¤×•× ×§×¦×™×•× ×œ×™. ×‘-frontend, ×”×§×•××¤×•× × ×˜×” × ×•×¦×¨×” ××š ×”×•×¡×¨×”. ×™×© ×œ×”×—×œ×™×˜ ×¢×œ ××¡×˜×¨×˜×’×™×™×ª ×”××™× ×˜×’×¨×¦×™×” ×•×œ×”×©×œ×™× ××ª ×”×—×œ×§×™× ×”×—×¡×¨×™×.
